<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_0inb4ax" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="2.2.4">
  <bpmn:process id="requestSimpleCohortSizeQuery" isExecutable="true" camunda:versionTag="1.0.0">
    <bpmn:startEvent id="StartEvent">
      <bpmn:outgoing>SequenceFlow_11k77gx</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDefinition_10c2suu" messageRef="Message_1pq9qxp" />
    </bpmn:startEvent>
    <bpmn:serviceTask id="checkInitialCohortSizeRequest" name="check initial cohort size request" camunda:class="org.highmed.dsf.bpe.service.CheckCohortSizeRequest">
      <bpmn:incoming>SequenceFlow_11k77gx</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1k2k5uj</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="selectTargetMedics" name="select target medics" camunda:class="org.highmed.dsf.bpe.service.SelectTargetMedics">
      <bpmn:incoming>SequenceFlow_1k2k5uj</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0b5s4ef</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sendTask id="sendCohortSizeRequest" name="send cohort size request" camunda:class="org.highmed.dsf.bpe.message.SendCohortSizeRequest">
      <bpmn:extensionElements>
	<camunda:inputOutput>
	  <camunda:inputParameter name="processDefinitionKey">pong</camunda:inputParameter>
	  <camunda:inputParameter name="versionTag">1.0.0</camunda:inputParameter>
	  <camunda:inputParameter name="messageName">ping</camunda:inputParameter>
	</camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_0b5s4ef</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0rd9moe</bpmn:outgoing>
      <bpmn:multiInstanceLoopCharacteristics camunda:collection="${multiInstanceTargets.targets}" camunda:elementVariable="multiInstanceTarget" />
    </bpmn:sendTask>
    <bpmn:receiveTask id="receiveCohortSizeResult" name="receive cohort size result " messageRef="Message_07ayhv1">
      <bpmn:extensionElements>
	<camunda:inputOutput>
	  <camunda:inputParameter name="correlationKey">${multiInstanceTarget.correlationKey}</camunda:inputParameter>
	</camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_0rd9moe</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0yat1ap</bpmn:outgoing>
      <bpmn:multiInstanceLoopCharacteristics camunda:collection="${multiInstanceTargets.targets}" camunda:elementVariable="multiInstanceTarget" />
    </bpmn:receiveTask>
    <bpmn:serviceTask id="calculateMultiMedicCohortSize" name="calculate multimedic cohort size" camunda:class="org.highmed.dsf.bpe.service.CalculateMultiMedicCohortSize">
      <bpmn:incoming>SequenceFlow_0yat1ap</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_1y8pn4v</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0ol49yu</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="checkReleaseResult" name="check &#38; release result for  researcher" camunda:class="org.highmed.dsf.bpe.service.CheckCohortSizeResult">
      <bpmn:incoming>SequenceFlow_0ol49yu</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0h6ci9o</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:endEvent id="success" name="success">
      <bpmn:incoming>SequenceFlow_0h6ci9o</bpmn:incoming>
      <bpmn:messageEventDefinition id="MessageEventDefinition_01fsoqz" camunda:class="org.highmed.dsf.bpe.message.SendCohortSizeResultToMedic" />
    </bpmn:endEvent>
    <bpmn:boundaryEvent id="timeout" name="timeout" attachedToRef="receiveCohortSizeResult">
      <bpmn:outgoing>SequenceFlow_1y8pn4v</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerEventDefinition_0aatcjx">
	<bpmn:timeDuration xsi:type="bpmn:tFormalExpression">PT5S</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="SequenceFlow_11k77gx" sourceRef="StartEvent" targetRef="checkInitialCohortSizeRequest" />
    <bpmn:sequenceFlow id="SequenceFlow_1k2k5uj" sourceRef="checkInitialCohortSizeRequest" targetRef="selectTargetMedics" />
    <bpmn:sequenceFlow id="SequenceFlow_0b5s4ef" sourceRef="selectTargetMedics" targetRef="sendCohortSizeRequest" />
    <bpmn:sequenceFlow id="SequenceFlow_0rd9moe" sourceRef="sendCohortSizeRequest" targetRef="receiveCohortSizeResult" />
    <bpmn:sequenceFlow id="SequenceFlow_0yat1ap" sourceRef="receiveCohortSizeResult" targetRef="calculateMultiMedicCohortSize" />
    <bpmn:sequenceFlow id="SequenceFlow_1y8pn4v" sourceRef="timeout" targetRef="calculateMultiMedicCohortSize" />
    <bpmn:sequenceFlow id="SequenceFlow_0ol49yu" sourceRef="calculateMultiMedicCohortSize" targetRef="checkReleaseResult" />
    <bpmn:sequenceFlow id="SequenceFlow_0h6ci9o" sourceRef="checkReleaseResult" targetRef="success" />
    <bpmn:endEvent id="failed" name="failed">
      <bpmn:incoming>SequenceFlow_1aagr9l</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_1qcepsl</bpmn:incoming>
      <bpmn:messageEventDefinition id="MessageEventDefinition_0bapjm8" camunda:class="org.highmed.dsf.bpe.message.SendErrorMessage" />
    </bpmn:endEvent>
    <bpmn:boundaryEvent id="errorResult" name="error result" attachedToRef="checkReleaseResult">
      <bpmn:outgoing>SequenceFlow_1aagr9l</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorEventDefinition_0n22xpw" />
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="SequenceFlow_1aagr9l" sourceRef="errorResult" targetRef="failed" />
    <bpmn:boundaryEvent id="errorRequest" name="error request" attachedToRef="checkInitialCohortSizeRequest">
      <bpmn:outgoing>SequenceFlow_1qcepsl</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorEventDefinition_1dwunbt" />
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="SequenceFlow_1qcepsl" name="check failed" sourceRef="errorRequest" targetRef="failed" />
    <bpmn:textAnnotation id="TextAnnotation_0xo0pht">
      <bpmn:text>uac check, study definiton validity, type of cohort, ethics commitee vote, included medics, user authentication, rate limit, etc.</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_08ibpi5" sourceRef="checkInitialCohortSizeRequest" targetRef="TextAnnotation_0xo0pht" />
    <bpmn:textAnnotation id="TextAnnotation_0cx1hgk">
      <bpmn:text>2do: error event handling</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_1ma2u5d" sourceRef="checkInitialCohortSizeRequest" targetRef="TextAnnotation_0cx1hgk" />
    <bpmn:textAnnotation id="TextAnnotation_1idf9wo">
      <bpmn:text>2do: error event handling</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_0g97he2" sourceRef="checkReleaseResult" targetRef="TextAnnotation_1idf9wo" />
  </bpmn:process>
  <bpmn:message id="Message_1pq9qxp" name="simpleCohortSizeQueryRequest" />
  <bpmn:message id="Message_07ayhv1" name="simpleCohortSizeQueryResult" />
  <bpmn:message id="Message_0gifb86" name="Message_0hl2gli" />
  <bpmn:error id="Error_0dl03kn" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="requestSimpleCohortSizeQuery">
      <bpmndi:BPMNShape id="TextAnnotation_0xo0pht_di" bpmnElement="TextAnnotation_0xo0pht">
	<dc:Bounds x="21" y="22" width="261" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="StartEvent_1ozsjmr_di" bpmnElement="StartEvent">
	<dc:Bounds x="49" y="117" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_1ujw7cn_di" bpmnElement="checkInitialCohortSizeRequest">
	<dc:Bounds x="191" y="95" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_0vfud44_di" bpmnElement="selectTargetMedics">
	<dc:Bounds x="371" y="95" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="SendTask_1pu8i9n_di" bpmnElement="sendCohortSizeRequest">
	<dc:Bounds x="553" y="95" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ReceiveTask_0d5eqbz_di" bpmnElement="receiveCohortSizeResult">
	<dc:Bounds x="728" y="95" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_0kldnl4_di" bpmnElement="calculateMultiMedicCohortSize">
	<dc:Bounds x="951" y="95" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_00phx5l_di" bpmnElement="checkReleaseResult">
	<dc:Bounds x="1121" y="95" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_1aaq3nn_di" bpmnElement="success">
	<dc:Bounds x="1365" y="117" width="36" height="36" />
	<bpmndi:BPMNLabel>
	  <dc:Bounds x="1363" y="160" width="40" height="14" />
	</bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BoundaryEvent_1vqzdxs_di" bpmnElement="timeout">
	<dc:Bounds x="810" y="157" width="36" height="36" />
	<bpmndi:BPMNLabel>
	  <dc:Bounds x="809" y="196" width="37" height="14" />
	</bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Association_08ibpi5_di" bpmnElement="Association_08ibpi5">
	<di:waypoint x="201" y="95" />
	<di:waypoint x="179" y="72" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_11k77gx_di" bpmnElement="SequenceFlow_11k77gx">
	<di:waypoint x="85" y="135" />
	<di:waypoint x="191" y="135" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1k2k5uj_di" bpmnElement="SequenceFlow_1k2k5uj">
	<di:waypoint x="291" y="135" />
	<di:waypoint x="371" y="135" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0b5s4ef_di" bpmnElement="SequenceFlow_0b5s4ef">
	<di:waypoint x="471" y="135" />
	<di:waypoint x="553" y="135" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0rd9moe_di" bpmnElement="SequenceFlow_0rd9moe">
	<di:waypoint x="653" y="135" />
	<di:waypoint x="728" y="135" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0yat1ap_di" bpmnElement="SequenceFlow_0yat1ap">
	<di:waypoint x="828" y="135" />
	<di:waypoint x="951" y="135" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1y8pn4v_di" bpmnElement="SequenceFlow_1y8pn4v">
	<di:waypoint x="846" y="175" />
	<di:waypoint x="888" y="175" />
	<di:waypoint x="888" y="135" />
	<di:waypoint x="951" y="135" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0ol49yu_di" bpmnElement="SequenceFlow_0ol49yu">
	<di:waypoint x="1051" y="135" />
	<di:waypoint x="1121" y="135" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0h6ci9o_di" bpmnElement="SequenceFlow_0h6ci9o">
	<di:waypoint x="1221" y="135" />
	<di:waypoint x="1365" y="135" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="TextAnnotation_0cx1hgk_di" bpmnElement="TextAnnotation_0cx1hgk">
	<dc:Bounds x="18" y="198" width="97" height="40" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Association_1ma2u5d_di" bpmnElement="Association_1ma2u5d">
	<di:waypoint x="191" y="159" />
	<di:waypoint x="109" y="198" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="TextAnnotation_1idf9wo_di" bpmnElement="TextAnnotation_1idf9wo">
	<dc:Bounds x="1218" y="27" width="100" height="40" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Association_0g97he2_di" bpmnElement="Association_0g97he2">
	<di:waypoint x="1214" y="96" />
	<di:waypoint x="1246" y="67" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_1chvj4k_di" bpmnElement="failed">
	<dc:Bounds x="1365" y="226" width="36" height="36" />
	<bpmndi:BPMNLabel>
	  <dc:Bounds x="1370" y="269" width="27" height="14" />
	</bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BoundaryEvent_0v53geq_di" bpmnElement="errorResult">
	<dc:Bounds x="1203" y="157" width="36" height="36" />
	<bpmndi:BPMNLabel>
	  <dc:Bounds x="1229" y="193" width="54" height="14" />
	</bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1aagr9l_di" bpmnElement="SequenceFlow_1aagr9l">
	<di:waypoint x="1221" y="193" />
	<di:waypoint x="1221" y="244" />
	<di:waypoint x="1365" y="244" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="BoundaryEvent_1f3nk2r_di" bpmnElement="errorRequest">
	<dc:Bounds x="273" y="157" width="36" height="36" />
	<bpmndi:BPMNLabel>
	  <dc:Bounds x="297" y="193" width="63" height="14" />
	</bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1qcepsl_di" bpmnElement="SequenceFlow_1qcepsl">
	<di:waypoint x="291" y="193" />
	<di:waypoint x="291" y="244" />
	<di:waypoint x="1365" y="244" />
	<bpmndi:BPMNLabel>
	  <dc:Bounds x="1229" y="228" width="59" height="14" />
	</bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
